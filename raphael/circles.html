<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
  <head>
    <title>Raphael JS - AIGA/ODC Circles Examples</title>
    <style type="text/css">
      #example { border: 1px solid #aaa; }
    </style>
  </head>
  
  <body>
    <div>
      <a href="/aiga-odc/raphael">Examples</a>
    </div>
    <div id="example"></div>
    <script src="/aiga-odc/raphael/raphael.js"></script>
    <script src="/aiga-odc/raphael/index.js"></script>
    <script>
      Raphael.fn.orbitalPlane = function(x, y, r) {
        var oribtalX = x - r - 20;
        var rxy = [r + 20, r + 20].join(",");
        var exy = [oribtalX, y - 0.00001].join(",");
        var plane = {
          path: ["M", oribtalX, y, "A", rxy, 0, "1,0", exy, "z"].join(" ")
        };
        return plane;
      };

      Raphael.fn.solarSystem = function(moonCount, x, y, r) {
        // var system = this.set();
        var planet = this.circle(x, y, r).attr({"fill":"yellow", "stroke":0});
        var orbitPlane = this.orbitalPlane(x, y, r);
        var plane = this.path(orbitPlane.path).attr({"stroke":1});
        var distanceApart = plane.getTotalLength() / moonCount;
        var radiansApart = 360 / moonCount;
        var pt = plane.getPointAtLength(0);
        // var pt = plane.getPointAtLength(0);
        // var orbit = function(m, p) {
        //   console.log("HERE %o", p);
        //   m.animateAlong(p, 5000, false);
        //   // setTimeout(function() {orbit(m);}, 5000);
        // };
        var that = this;
        var moons = [];
        for (var i=0; i < moonCount; i++) {
          (function() {
            // var orbit = that.orbitalPlane(x, y, r);
            // var plane = that.path(orbit.path).attr({"stroke":1});
            // var distanceApart = plane.getTotalLength() / moonCount;
            // console.log("Radians: " + (radiansApart * i));
            // var pt = plane.getPointAtLength(distanceApart * i);
            var moon = that.circle(pt.x, pt.y, 10).attr({"fill":"yellow", "stroke":0});
            moons.push(moon);
            // var orbit = function(m, p) {
            //   m.animateAlong(p, 5000, false);
            // }
            // setTimeout( function() {
            //   // var pt2 = plane.getPointAtLength(distanceApart * i);
            //   // var nextpath = plane.getSubpath(pt2, plane.getTotalLength());
            //   orbit(moon, plane);
            // }, (5000/moonCount * i));
          })();
        }
        planet.mouseover(function(event) {
          var speed = 1000;
          var animateDelay = speed / moonCount;
          var orbit = function(moon, plane, rotations, count) {
            count = count || 0;
            moon.animateAlong(plane, speed, false);
            if (count < 5) {
              setTimeout(function() { orbit(moon, plane, rotations, count + 1); }, speed);
            } else {
              // moon.hide();
            }
          }
          for (var i=0; i < moonCount; i++) {
            (function() {
              var moon = moons[i];
              // moon.show();
              setTimeout( function() { orbit(moon, plane, 5); }, animateDelay * i);
            })();
          }
        });
      };

      window.onload = function() {
        var bg = Raphael(document.getElementById("example"), 800, 400);
        bg.solarSystem(5, 150, 90, 50);
      };
    </script>
  </body>
</html>
